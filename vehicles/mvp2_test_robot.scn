<?xml version="1.0"?>
<!--
    This file is part of ALPHA AUV project.
    Author: Emir Cem Gezer
    Email: emircem@uri.edu;emircem.gezer@gmail.com
    Year: 2022
    Copyright (C) 2022 Smart Ocean Systems Laboratory
-->
<scenario>
    <robot name="$(arg robot_name)" fixed="false" self_collisions="false">
        <base_link name="Vehicle" type="compound" physics="submerged">
            <external_part name="Hull" type="model" physics="floating" buoyant="false">
                <physical>
                    <mesh filename="parts/body/hull_mk2_reduced.obj" scale="0.001"/>
                    <origin rpy="1.5707 0.0 0.0" xyz="0.0 0.0 0.0"/>
                </physical>
                <visual>
                    <mesh filename="parts/body/hull_mk2_visual.obj" scale="0.001"/>
                    <origin rpy="1.5707 0.0 0.0" xyz="0.0 0.0 0.0"/>
                </visual>
                <material name="Vehicle"/>
                <look name="yellow"/>
                <mass value="30.0"/>
                <!-- <inertia xyz="1.0 5.0 5.0"/> -->
                <compound_transform rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
                <cg xyz="-0.65 0.0 0.00" rpy="0.0 0.0 0.0"/>
            </external_part>

            <internal_part name="Foam" type="cylinder" physics="floating" buoyant="true">
                <dimensions radius="0.12" height="0.68"/>
                <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
                <material name="Foam"/>
                <mass value="0.5"/>
                <look name="grey"/>
                <compound_transform rpy="0.0 1.571 0.0" xyz="-0.65 0.0 -0.1"/>
            </internal_part>

            <external_part name="Mast" type="model" physics="submerged">
                <physical>
                    <mesh filename="parts/others/mast.obj" scale="0.001"/>
                    <origin rpy="-1.571 0.0 1.571"  xyz="-1.0 0.0 0.0"/>
                </physical>
                <visual>
                    <mesh filename="parts/others/mast.obj" scale="0.001"/>
                    <origin rpy="-1.571 0.0 1.571" xyz="-1.0 0.0 0.0"/>
                </visual>
                <material name="Resin"/>
                <look name="red"/>
                <compound_transform rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            </external_part>

            <external_part name="ThrusterDuctSurge" type="model" physics="submerged" buoyant="false">
                <physical>
                    <mesh filename="parts/thruster/duct.obj" scale="0.0015"/>
                    <origin rpy="0.0 1.571 0.0" xyz="-1.5 0.0 0.0"/>
                </physical>
                <visual>
                    <mesh filename="parts/thruster/duct.obj" scale="0.0015"/>
                    <origin rpy="0.0 1.571 0.0" xyz="-1.5 0.0 0.0"/>
                </visual>
                <material name="Neutral"/>
                <look name="black"/>
                <compound_transform rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            </external_part>
        </base_link>

        <!-- the actual base frame  -->
        <link name="Base" type="box" physics="submerged">
            <dimensions xyz="0.01 0.02 0.01"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <material name="Neutral"/>
            <look name="Green"/>
        </link>


        <joint name="Joint1" type="fixed">
            <parent name="Vehicle"/>
            <child name="Base"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <axis xyz="1.0 0.0 0.0"/>
        </joint>

        <!--  -->
        <!-- Thruster -->
         <actuator name="ThrusterSurge" type="propeller">
                <link name="Base"/>
                <origin rpy="0.0 0.0 0.0" xyz="-1.5 0.0 0.0"/>
                <specs thrust_coeff="100.0" torque_coeff="0.01" max_rpm="3000.0"/>
                 <!-- <specs thrust_coeff="0.3411" torque_coeff="0.01" max_rpm="3000.0"/> -->
                <propeller diameter="0.1145" right="true">
                    <origin rpy="1.571 0.0 0.0" xyz="0.0 0.0 0.0"/>
                    <mesh filename="parts/thruster/prop.obj" scale="1.0"/>
                    <mesh filename="prop.obj" scale="1.5"/>
                    <material name="Neutral"/>
                    <look name="red"/>
                </propeller>
        </actuator>

        <actuator name="ThrusterSwayBow" type="propeller">
            <link name="Base"/>
            <origin rpy="0.0 0.0 -1.5707963" xyz="-0.2295 0.0 0.0"/>
            <specs thrust_coeff="0.4472" thrust_coeff_backward="0.3566" torque_coeff="0.01" max_rpm="3000.0"/>
            <propeller diameter="0.08" right="true">
                <mesh filename="parts/thruster/prop.obj" scale="1.0"/>
                <material name="Neutral"/>
                <look name="white"/>
            </propeller>
        </actuator>

        <actuator name="ThrusterHeaveStern" type="propeller">
            <link name="Base"/>
            <origin rpy="0.0 1.571 0.0" xyz="-1.13 0.0 0.0"/>
            <specs thrust_coeff="0.4472" thrust_coeff_backward="0.4472" torque_coeff="0.01" max_rpm="3000.0"/>
            <propeller diameter="0.08" right="true">
                <mesh filename="parts/thruster/prop.obj" scale="1.0"/>
                <mesh filename="prop.obj" scale="1.0"/>
                <material name="Neutral"/>
                <look name="white"/>
            </propeller>
        </actuator>

        <actuator name="ThrusterHeaveBow" type="propeller">
            <link name="Base"/>
            <origin rpy="0.0 1.571 0.0" xyz="-0.3545 0.0 0.0"/>
            <specs thrust_coeff="0.4472" thrust_coeff_backward="0.4472" torque_coeff="0.01" max_rpm="3000.0"/>
            <propeller diameter="0.08" right="true">
                <mesh filename="parts/thruster/prop.obj" scale="1.0"/>
                <mesh filename="prop.obj" scale="1.0"/>
                <material name="Neutral"/>
                <look name="white"/>
            </propeller>
        </actuator>


        <!-- sensors -->
        <sensor name="gps" type="gps" rate="1.0">
            <link name="Base"/>
            <origin rpy="0.0 0.0 0.0" xyz="-0.7 0.0 -0.3"/>
            <noise ned_position="0.0"/>
            <ros_publisher topic="$(arg robot_name)/gps/fix"/>
        </sensor>

         <sensor name="imu_sf" type="imu" rate="20.0">
                <link name="Base"/>
                <origin rpy="3.1415926 0.0 0.0" xyz="-0.7 0.0 -0.05"/>
                <noise angle="0.0001 0.0001 0.0001" angular_velocity="0.0001" yaw_drift="0.0001" linear_acceleration="0.0001"/>
                <ros_publisher topic="$(arg robot_name)/imu/stonefish/data"/>
        </sensor>

        <sensor name="pressure" type="pressure" rate="5.0">
                <link name="Base"/>
                <origin rpy="0.0 0.0 0.0" xyz="-1.0 0.0 0.0"/>
                <noise pressure="2.0"/>
                <ros_publisher topic="$(arg robot_name)/pressure"/>
        </sensor>

        <sensor name="dvl_sf" type="dvl" rate="5.0">
            <link name="Base"/>
            <origin rpy="3.1415926 0.0 0.0" xyz="-0.55 0.0 0.1"/>
            <specs beam_angle="30.0"/>
            <range velocity="9.0 9.0 9.0" altitude_min="0.2" altitude_max="200.0"/>
            <noise velocity="0.01" altitude="0.001"/>
            <ros_publisher topic="$(arg robot_name)/dvl/stonefish/raw" altitude_topic="$(arg robot_name)/dvl/stonefish/altitude"/>
        </sensor>

        <comm name="USBL" device_id="1" type="usbl">
            <specs min_vertical_fov="0.0" max_vertical_fov="360.0" range="1000.0"/>
            <connect device_id="2" occlusion_test="false"/>
            <autoping rate="1.0"/>
            <noise range="0.05" horizontal_angle="0.2" vertical_angle="0.5"/>
            <resolution range="0.1" angle="0.1"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <link name="Base"/>
            <ros_publisher topic="$(arg robot_name)/stonefish/usbl"/>
        </comm>

        <world_transform xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>


        <!-- <ros_subscriber thrusters="/mvp2_test_robot/stonefish/thruster_command" servos="/mvp2_test_robot/fins/desired_joint_states"/>  -->
		<!-- <ros_publisher thrusters="/mvp2_test_robot/stonefish/thruster_state" servos="/mvp2_test_robot/fins/joint_states"/> -->
        <ros_subscriber propellers="$(arg robot_name)/stonefish/thruster_command"/> 
		<ros_publisher propellers="$(arg robot_name)/stonefish/thruster_state"/>
    </robot>
</scenario>